(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();const m=Object.freeze({DRAW_THEN_SHUFFLE:1,SEARCH_BY_ID_THEN_SHUFFLE:2});class v{deck;hand;constructor(e,t){this.deck=e,this.hand=t}apply(){const e=this.deck.drawCard();this.deck.shuffle(),e&&this.hand.addOneCard(e)}}class g{deck;hand;cardId;constructor(e,t,s){this.deck=e,this.hand=t,this.cardId=s}apply(){const e=this.deck.getCardById(this.cardId);this.deck.shuffle(),e&&this.hand.addOneCard(e)}}class k{id;name;description;effect;effectMeta;constructor(e){this.id=e.id,this.name=e.name,this.description=e.description,this.effect=null,this.effectMeta=null,e.effect&&(this.effectMeta=e.effect)}setEffectBasedOnType(e,t){if(this.effectMeta)switch(this.effectMeta.type){case m.DRAW_THEN_SHUFFLE:this.effect=new v(e,t);break;case m.SEARCH_BY_ID_THEN_SHUFFLE:this.effect=new g(e,t,this.effectMeta.target);break}}getId(){return this.id}getName(){return this.name}getDescription(){return this.description}getEffect(){return this.effect}}class y{name;initialDrawAfterFirstShuffle;drawQuantityInEachTurn;cards;cardQuantityListeners;constructor(e){this.name=e.name,this.initialDrawAfterFirstShuffle=e.initialDrawAfterFirstShuffle,this.drawQuantityInEachTurn=e.drawQuantityInEachTurn,this.cards=[],this.cardQuantityListeners=[],e.cards.forEach(t=>{for(let s=0;s<t.quantity;s++)this.cards.push(new k(t))})}getName(){return this.name}getInitialDraw(){return this.initialDrawAfterFirstShuffle}getDrawInEachTurn(){return this.drawQuantityInEachTurn}getCards(){return this.cards}shuffle(){let e=this.cards;for(let t=e.length-1;t>=1;t--){let s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}}drawInitialQuantity(){return this.shuffle(),this.cards.splice(0,this.initialDrawAfterFirstShuffle)}drawCard(){let e;return this.cards.length>0?(e=this.cards.shift(),this.cardQuantityListeners.forEach(t=>t(this.cards.length)),e):null}getCardById(e){let t,s;if(this.cards.length>0)return s=this.cards.findIndex(r=>r.getId()==e),t=this.cards.splice(s,1)[0],this.cardQuantityListeners.forEach(r=>r(this.cards.length)),t}addListenerForCardQuantityChange(e){this.cardQuantityListeners.push(e)}removeListeners(){this.cardQuantityListeners.length=0}}class I{cards;onCardRemovedListeners;constructor(){this.cards=[],this.onCardRemovedListeners=[]}addOneCard(e){this.cards.push(e)}removeCard(e){let t=this.cards[e];return this.onCardRemovedListeners?.forEach(s=>s(t)),this.cards=this.cards.filter((s,r)=>e!=r),t}getCards(){return this.cards}setInitialHand(e){this.cards=e}onCardRemoved(e){this.onCardRemovedListeners.push(e)}removeListeners(){this.onCardRemovedListeners.length=0}}class w{root;text;cardCount;deckName;constructor(e){this.root=document.createElement("div"),this.text=document.createElement("p"),this.cardCount=document.createElement("p"),this.deckName=document.createElement("p"),this.text.innerText="Deck",this.root.classList.add("deck-ui"),this.text.classList.add("deck-ui-text"),this.cardCount.classList.add("deck-ui-card-count"),this.deckName.classList.add("deck-ui-deck-name"),this.root.append(this.text,this.cardCount),e?.append(this.root,this.deckName)}onClick(e){this.root.addEventListener("click",e)}updateCardCount(e){this.cardCount.innerText=e.toString()}updateDeckName(e){this.deckName.innerText=e}}class D{root;text;card;clickHandler;hoverHandler;constructor(e,t){this.root=document.createElement("div"),this.text=document.createElement("p"),this.card=t,this.text.innerText=t.getName(),this.root.classList.add("hand-ui-card"),this.root.appendChild(this.text),e.appendChild(this.root)}onClick(e){this.clickHandler=e,this.root.addEventListener("click",this.clickHandler)}removeOnClickHandler(){this.root.removeEventListener("click",this.clickHandler)}onHover(e){this.root.addEventListener("mouseenter",()=>e.onMouseEnter(this.card)),this.root.addEventListener("mouseleave",()=>e.onMouseLeave())}removeOnHover(){this.root.removeEventListener("mouseenter",()=>this.hoverHandler.onMouseEnter(this.card)),this.root.removeEventListener("mouseleave",()=>this.hoverHandler.onMouseLeave())}}class H{root;cardDescription;cards;constructor(e){this.root=document.createElement("div"),this.cardDescription=document.createElement("p"),this.root.classList.add("hand-ui"),this.cardDescription.classList.add("hand-ui-card-description"),e?.appendChild(this.cardDescription),e?.appendChild(this.root)}addEventHandler(e,t,s){let r=this.cardDescription;e.onClick(()=>{s.removeCard(t).getEffect()?.apply(),this.cards.forEach(c=>c.removeOnClickHandler()),this.updateUI(s)}),e.onHover({onMouseEnter(i){i.getDescription().replaceAll(" ","")!=""&&(r.classList.add("display-description"),r.innerText=i.getDescription())},onMouseLeave(){r.classList.remove("display-description"),r.innerText=""}})}updateUI(e){let t=e.getCards();this.root.hasChildNodes()&&this.root.replaceChildren(),this.cards=[],t.forEach((s,r)=>{this.cards.push(new D(this.root,s)),this.addEventHandler(this.cards[r],r,e)})}}class N{cards;onCardAddedListeners;constructor(){this.cards=[],this.onCardAddedListeners=[]}addCard(e){this.cards.push(e),this.onCardAddedListeners.forEach(t=>t(this.cards.length))}getCards(){return this.cards}onCardAdded(e){this.onCardAddedListeners.push(e)}removeListeners(){this.onCardAddedListeners.length=0}}class R{root;text;cardCount;cardListRoot;clickListener;constructor(e){this.root=document.createElement("div"),this.text=document.createElement("p"),this.cardCount=document.createElement("p"),this.cardListRoot=document.createElement("div"),this.text.innerText="Discard Pile",this.cardCount.innerText="0",this.root.id="discard-pile-ui",this.cardListRoot.id="discard-pile-card-list-ui",this.root.append(this.text,this.cardCount),e.append(this.root,this.cardListRoot)}drawCardNamesIntoList(e){let t,s=document.createElement("button"),r=document.createElement("div"),i=document.createElement("div");this.cardListRoot.hasChildNodes()&&this.cardListRoot.replaceChildren(),s.innerText="Close",r.id="btn-container",i.id="cards-container";for(let c=e.length-1;c>=0;c--)t=document.createElement("p"),t.innerText=e[c].getName(),i.append(t);r.appendChild(s),r.addEventListener("click",c=>this.dismissCardList()),this.cardListRoot.classList.add("show-discard-pile-list"),this.cardListRoot.append(r,i)}dismissCardList(){this.cardListRoot.classList.contains("show-discard-pile-list")&&this.cardListRoot.classList.remove("show-discard-pile-list")}onClick(e){this.root.removeEventListener("click",this.clickListener),this.clickListener=e,this.root.addEventListener("click",this.clickListener)}updateCardCounter(e){this.cardCount.innerText=e.toString()}}const p=document.getElementById("app"),E=document.getElementById("file-input"),u=document.getElementById("load-deck-btn");let n=null,a=null,f=null,C=null,L=!1,o,l,h;function x(){L?(o.updateDeckName(n.getName()),o.updateCardCount(n.getCards().length),l.updateUI(a),h.updateCardCounter(0)):(u.classList.add("load-deck-btn-when-game-started"),u.addEventListener("animationend",()=>{L=!0,o=new w(p),l=new H(p),h=new R(p),o.updateDeckName(n.getName()),o.updateCardCount(n.getCards().length),l.updateUI(a),o.onClick(()=>{let e;e=n.drawCard(),e&&(a.addOneCard(e),l.updateUI(a))}),h.onClick(()=>{h.drawCardNamesIntoList(f.getCards()),u.classList.add("to-behind")}),n.addListenerForCardQuantityChange(e=>{o.updateCardCount(e)}),a.onCardRemoved(e=>l.updateUI(a)),a.onCardRemoved(e=>f.addCard(e)),a.onCardRemoved(e=>h.dismissCardList()),f.onCardAdded(e=>h.updateCardCounter(e))})),n.addListenerForCardQuantityChange(d=>{o.updateCardCount(d)})}E.addEventListener("change",d=>{const t=d.target.files[0],s=new FileReader;t&&t.type=="application/json"&&(s.onloadend=()=>{C=JSON.parse(s.result),n=new y(C),a=new I,f=new N,n.getCards().forEach(r=>r.setEffectBasedOnType(n,a)),a.setInitialHand(n.drawInitialQuantity()),x()},s.readAsText(t))});u.addEventListener("click",d=>E.click());
